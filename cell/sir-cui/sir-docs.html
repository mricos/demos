<!-- Documentation panel for SIR model (loaded dynamically into sir.html) -->

<div class="docpanel" id="docPanel" role="dialog" aria-label="Documentation">
  <div class="dochead">
    <div class="tabs" role="tablist" aria-label="Docs tabs">
      <button class="tab" role="tab" aria-selected="true" aria-controls="tabModel" id="tabBtnModel">Model</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tabNumerics" id="tabBtnNumerics">Numerics</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tabPatterns" id="tabBtnPatterns">Patterns</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tabExamples" id="tabBtnExamples">Examples</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tabParams" id="tabBtnParams">Design</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tabConfig" id="tabBtnConfig">Config</button>
    </div>
    <div class="subtabs" id="numericsSubtabs" role="tablist" aria-label="Numerics subtabs">
      <button class="subtab" role="tab" aria-selected="true" aria-controls="tabNumThreshold" id="tabBtnNumThreshold">Threshold Dynamics</button>
      <button class="subtab" role="tab" aria-selected="false" aria-controls="tabNumR0Control" id="tabBtnNumR0Control">R₀ Control</button>
    </div>
  </div>
  <div class="docbody">
    <section id="tabModel">
      <h4>Compartment Model</h4>
      <p>Agents are <code class="sir-s">S</code>usceptible, <code class="sir-i">I</code>nfected, or <code class="sir-r">R</code>ecovered. Motion is a bounded random walk with specular reflection. A <span class="sir-s">susceptible</span> within radius <code>r</code> of an <span class="sir-i">infected</span> is infected with Bernoulli probability <code>p</code> per contact. <span class="sir-r">Recoveries</span> are a Poisson process with hazard <code>γ</code>.</p>

      <h4 style="margin-top:16px">Controls</h4>
      <ul>
        <li><b>N</b>: live-resized population. Additions spawn as <span class="sir-s">susceptible</span>; removals are unbiased across compartments.</li>
        <li><b>i₀</b>: seeds/removes <span class="sir-i">infected</span> instantly to match the target count.</li>
        <li><b>v,r,p,γ</b>: update dynamics immediately. <b>Noise</b> perturbs <code>p</code> each step.</li>
        <li><b>Horizon</b>: trims the plotted window; does not affect dynamics.</li>
      </ul>

      <h4 style="margin-top:16px">Dynamical Analogies</h4>
      <p>The SIR equations represent a <b>3-state flow system</b> with conversion rules. This pattern appears across nature:</p>
      <ul>
        <li><b>Chemical kinetics</b>: <span class="sir-s">Reactant</span> → <span class="sir-i">Intermediate</span> → <span class="sir-r">Product</span> (e.g., autocatalytic reactions)</li>
        <li><b>Cell morphogenesis</b>: Ion gradients (Na⁺/K⁺/Ca²⁺) driving bioelectric patterns that guide tissue development</li>
        <li><b>Predator-prey</b>: Resource → Consumer → Decomposer cycles in ecological food webs</li>
        <li><b>Social dynamics</b>: Information cascades (Unaware → Engaged → Saturated) in memetic spread</li>
        <li><b>Material states</b>: Phase transitions with metastable intermediates (solid → liquid → gas)</li>
      </ul>
      <p>All share: <b>conservation law</b> (N=<span class="sir-s" data-var-ref="S" data-format="value">S</span>+<span class="sir-i" data-var-ref="I" data-format="value">I</span>+<span class="sir-r" data-var-ref="R" data-format="value">R</span>), <b>threshold behavior</b> (<span class="r-number" data-var-ref="R0" data-format="value">R₀</span> critical point), and <b>irreversible flow</b> (no <span class="sir-r">R</span>→<span class="sir-s">S</span> backflow).</p>
      <p><i>Unique to spatial SIR:</i> The agent-based approach couples diffusion with reaction, revealing pattern formation—akin to Turing morphogens or Belousov-Zhabotinsky waves.</p>
    </section>
    <section id="tabNumThreshold" hidden>
      <h4>Threshold Dynamics</h4>

      <h4 style="font-size:16px; margin-top:14px">Numerical Implementation</h4>
      <p>Fixed sub-stepping at <code>h=1/60</code> s with capped <code>Δt≤50</code> ms. Pair checks are O(N²) for clarity; N≤1500 is supported. Canvas is pixel-scaled by device pixel ratio.</p>

      <h4 style="font-size:16px; margin-top:14px">Basic Reproduction Number (R₀)</h4>
      <p>The kinetic approximation yields:</p>
      <p style="text-align:center; font-size:16px; margin:12px 0"><code><span class="r-number">R₀</span> ≈ (2 r v ρ p) / γ</code></p>
      <p>Where:</p>
      <ul>
        <li><b>r</b> = contact radius (px)</li>
        <li><b>v</b> = agent speed (px/s)</li>
        <li><b>ρ</b> = areal density N/A (agents/px²)</li>
        <li><b>p</b> = infectivity (probability per contact)</li>
        <li><b>γ</b> = recovery rate (1/s)</li>
      </ul>

      <h4 style="font-size:16px; margin-top:14px">Effective Reproduction Number (Rₜ)</h4>
      <p>The time-varying effective reproduction number accounts for depletion of susceptibles:</p>
      <p style="text-align:center; font-size:16px; margin:12px 0"><code><span class="r-number" data-var-ref="Rt" data-format="value">Rₜ</span> = <span class="r-number" data-var-ref="R0" data-format="value">R₀</span> · (<span class="sir-s" data-var-ref="S" data-format="value">S</span>/N)</code></p>
      <p>As the epidemic progresses, <span class="sir-s">S</span> decreases, so <span class="r-number" data-var-ref="Rt" data-format="value">Rₜ</span> falls even if behavior doesn't change.</p>

      <h4 style="font-size:16px; margin-top:14px">Critical Threshold</h4>
      <p>When <code><span class="r-number">R₀</span>≈1</code> or <code><span class="r-number">Rₜ</span>≈1</code>, the system is at the <b>epidemic threshold</b>:</p>
      <ul>
        <li><b>R₀ &gt; 1</b>: Epidemic grows exponentially</li>
        <li><b>R₀ ≈ 1</b>: Metastable critical regime (percolation clusters)</li>
        <li><b>R₀ &lt; 1</b>: Epidemic dies out stochastically</li>
      </ul>
      <p>The UI enters <b>critical mode</b> near threshold: pulsing FAB, ambient overlay, velocity damping to emphasize marginal dynamics.</p>
    </section>

    <section id="tabNumR0Control" hidden>
      <h4>R₀ Control Mode</h4>
      <p>By default, R₀ is <b>computed</b> from the simulation parameters (r, v, ρ, p, γ). However, you can switch to <b>manual R₀ mode</b> to directly set a target R₀ value.</p>

      <h4 style="font-size:16px; margin-top:14px">How It Works</h4>
      <p>In the control panel, use the <b>R₀ Control Mode</b> toggle:</p>
      <ul>
        <li><b>Computed</b> (default): R₀ = (2 r v ρ p) / γ is displayed based on current parameters</li>
        <li><b>Set R₀</b> (manual): You specify a target R₀, and the system automatically adjusts <span class="sir-i">infectivity p</span> to achieve it</li>
      </ul>

      <h4 style="font-size:16px; margin-top:14px">The Mathematics</h4>
      <p>When you set a target R₀, the system solves for infectivity:</p>
      <p style="text-align:center; font-size:16px; margin:12px 0"><code>p = (R₀ · γ) / (2 r v ρ)</code></p>
      <p>This is the inverse of the R₀ formula. The computed <code>p</code> is clamped to [0.02, 0.9] to remain physically realistic.</p>

      <h4 style="font-size:16px; margin-top:14px">Behavior in Manual Mode</h4>
      <ul>
        <li>When you change <b>r, v, N, or γ</b>, the system <i>automatically re-adjusts p</i> to maintain your target R₀</li>
        <li>The <span class="sir-i">infectivity slider p</span> updates visually to show the calculated value</li>
        <li>You can manually adjust p directly, which will break the R₀ lock (switch back to Computed mode)</li>
        <li>The displayed R₀ always shows the <i>actual</i> value given current parameters</li>
      </ul>

      <h4 style="font-size:16px; margin-top:14px">Why This Is Useful</h4>
      <p><b>Exploring threshold behavior:</b> Set R₀ = 1.0 to study critical dynamics without guessing parameter combinations.</p>
      <p><b>Comparing scenarios:</b> Fix R₀ = 2.5 while varying speed or contact radius to see how spatial structure affects outcomes at constant reproductive rate.</p>
      <p><b>Educational:</b> Demonstrates that R₀ is an <i>emergent property</i> determined by multiple coupled parameters, not a single "infectiousness" knob.</p>

      <h4 style="font-size:16px; margin-top:14px">Limitations</h4>
      <ul>
        <li>If the required <code>p</code> falls outside [0.02, 0.9], the system clamps it, so actual R₀ may differ from target</li>
        <li>Only <code>p</code> is adjusted; alternatively, one could solve for γ or r, but p is the most intuitive parameter</li>
        <li>Population density ρ changes with canvas size and N, which can cause R₀ drift on window resize</li>
      </ul>

      <h4 style="font-size:16px; margin-top:14px">Example Workflow</h4>
      <p><b>1.</b> Switch to <b>Set R₀</b> mode<br>
      <b>2.</b> Set target R₀ = 1.2 (just above epidemic threshold)<br>
      <b>3.</b> Adjust <b>speed v</b> or <b>radius r</b> and observe how <code>p</code> auto-adjusts to compensate<br>
      <b>4.</b> Try different <b>initialization patterns</b> to see spatial heterogeneity at constant R₀<br>
      <b>5.</b> Switch back to <b>Computed</b> mode to explore freely</p>
    </section>
    <section id="tabExamples" hidden>
      <h4>Example Scenarios</h4>
      <div class="example-grid">
        <button class="example-btn" data-example="mild">
          <div class="example-title">Mild Outbreak</div>
          <div class="example-desc">Low infectivity (p=0.1), slow spread, <span class="r-number">R₀</span> ≈ 1.8</div>
        </button>
        <button class="example-btn" data-example="fastspread">
          <div class="example-title">Fast Spread</div>
          <div class="example-desc">High speed & infectivity (p=0.4, v=150), rapid transmission</div>
        </button>
        <button class="example-btn" data-example="critical">
          <div class="example-title">Critical Threshold</div>
          <div class="example-desc"><span class="r-number">R₀</span> ≈ 1, balanced at epidemic threshold</div>
        </button>
        <button class="example-btn" data-example="superspreader">
          <div class="example-title">Superspreader Event</div>
          <div class="example-desc">High initial <span class="sir-i">infected</span> (i₀=30), dense population</div>
        </button>
        <button class="example-btn" data-example="slowburn">
          <div class="example-title">Slow Burn</div>
          <div class="example-desc">Low speed (v=30), slow <span class="sir-r">recovery</span> (γ=0.005), prolonged epidemic</div>
        </button>
        <button class="example-btn" data-example="fastrecovery">
          <div class="example-title">Fast <span class="sir-r">Recovery</span></div>
          <div class="example-desc">High <span class="sir-r">recovery</span> rate (γ=0.08), short infectious period</div>
        </button>
      </div>
    </section>
    <section id="tabPatterns" hidden>
      <h4>Spatial Pattern Formation</h4>
      <p>Coupling agent mobility with <span class="sir-s">S</span>→<span class="sir-i">I</span>→<span class="sir-r">R</span> transitions creates emergent 2D structures. What patterns appear depends on the balance between <b>diffusion</b> (speed v) and <b>reaction</b> (infectivity p, recovery γ).</p>
      <p style="font-size:13px; color:var(--muted); margin:8px 0"><i>Click parameter values to apply them instantly</i></p>

      <h4 style="font-size:16px; margin-top:16px">1. Traveling Epidemic Waves</h4>
      <p style="margin-left:20px"><b>When:</b>
           <span class="r-number">R₀</span> &gt; 1.5, moderate γ</p>
      <p style="margin-left:20px"><b>What:</b>
           Circular or spiral <span class="sir-i">infection fronts</span> expand radially from seed points. Behind each wave, a trailing <span class="sir-r">recovery zone</span> forms, leaving immune "burned" regions.</p>
      <p style="margin-left:20px"><b>Speed:</b>
           Wave velocity ∝ √(v·p/γ). Faster motion or higher infectivity → faster spread.</p>
      <p style="margin-left:20px"><b>Try:</b>
           Set <span class="param-set" data-param="p" data-value="0.35">p=0.35</span>, <span class="param-set" data-param="speed" data-value="120">v=120</span>, <span class="param-set" data-param="gamma" data-value="0.02">γ=0.02</span>—watch concentric rings propagate.</p>

      <h4 style="font-size:16px; margin-top:16px">2. Percolation Clusters (Critical Regime)</h4>
      <p style="margin-left:20px"><b>When:</b>
           <span class="r-number">R₀</span> ≈ 1</p>
      <p style="margin-left:20px"><b>What:</b>
           Infection spreads along narrow, branching paths—fractal-like tendrils. Some clusters <span class="sir-r">recover</span> before spreading; others barely percolate through gaps in the <span class="sir-s">susceptible</span> population.</p>
      <p style="margin-left:20px"><b>Physics:</b>
           Near criticality, correlation length diverges. Small fluctuations have macroscopic consequences.</p>
      <p style="margin-left:20px"><b>Try:</b>
           Set <span class="param-set" data-param="p" data-value="0.15">p=0.15</span>, <span class="param-set" data-param="gamma" data-value="0.025">γ=0.025</span>, <span class="param-set" data-param="speed" data-value="60">v=60</span>—observe dendritic growth and local extinctions.</p>

      <h4 style="font-size:16px; margin-top:16px">3. Stochastic Patchiness (With Noise)</h4>
      <p style="margin-left:20px"><b>When:</b>
           Noise &gt; 20%</p>
      <p style="margin-left:20px"><b>What:</b>
           Spatially heterogeneous infectivity creates irregular "hotspots" and "coldspots." Some regions saturate while adjacent areas remain <span class="sir-s">susceptible</span>.</p>
      <p style="margin-left:20px"><b>Mechanism:</b>
           Random variation in p breaks spatial symmetry, preventing uniform wave fronts.</p>
      <p style="margin-left:20px"><b>Try:</b>
           Set <span class="param-set" data-param="noise" data-value="40">noise=40%</span>, <span class="param-set" data-param="p" data-value="0.22">p=0.22</span>—watch patchy, ragged invasion.</p>

      <h4 style="font-size:16px; margin-top:16px">Why NOT Turing Patterns?</h4>
      <p>Classic Turing structures (stripes, spots) require <b>differential diffusion</b> + <b>local activation/long-range inhibition</b>. Here, all agents diffuse identically, and SIR is globally transient (→ all <span class="sir-r">R</span>). You get <i>propagating</i> waves, not <i>stationary</i> periodic patterns.</p>

      <h4 style="font-size:16px; margin-top:16px">Optimal Parameters for Pattern Visibility</h4>
      <ul>
        <li><b>Low γ</b> (<span class="param-set" data-param="gamma" data-value="0.005">0.005</span>–<span class="param-set" data-param="gamma" data-value="0.01">0.01</span>): Persistent <span class="sir-i">infection</span> zones → sharp wave boundaries</li>
        <li><b>Moderate p</b> (<span class="param-set" data-param="p" data-value="0.15">0.15</span>–<span class="param-set" data-param="p" data-value="0.25">0.25</span>): Balances infection spread vs. stochastic die-off</li>
        <li><b>High N</b> (&gt;<span class="param-set" data-param="N" data-value="300">300</span>): Reduces noise, reveals deterministic structure</li>
        <li><b><span class="r-number">R₀</span> near critical</b>: Try <span class="param-set" data-param="p" data-value="0.18">p=0.18</span>, <span class="param-set" data-param="gamma" data-value="0.025">γ=0.025</span>, <span class="param-set" data-param="speed" data-value="60">v=60</span> for intricate spatial dynamics</li>
      </ul>
    </section>
    <section id="tabParams" hidden>

        <!-- Color Section (Collapsible) -->
        <details open style="margin-bottom:8px; border:1px solid rgba(26,38,54,.5); border-radius:8px; padding:12px">
          <summary style="font-size:16px; font-weight:600; color:var(--text); cursor:pointer; user-select:none; list-style:none">
            Color
          </summary>
          <div style="margin-top:16px">
            <p style="margin:0 0 16px 0; font-size:13px; color:var(--muted)">Define 8 semantic colors. Secondary and tertiary variants are auto-generated with guaranteed contrast.</p>

          <!-- Color Pickers (2-column grid with names) -->
          <div style="margin-bottom:16px">
            <h5 style="margin:0 0 8px 0; font-size:14px; color:var(--text)">Base Colors</h5>
            <div id="primaryPalette" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:8px">
              <!-- Color pickers will be inserted here -->
            </div>
          </div>

          <!-- Palette Triads Display -->
          <div style="margin-bottom:16px">
            <h5 style="margin:0 0 8px 0; font-size:14px; color:var(--text)">Palette Triads</h5>

            <!-- Primary Row -->
            <div class="triad-row" data-triad="primary" style="margin-bottom:8px; padding:8px; border:2px solid var(--selected-border); border-radius:6px; cursor:pointer; transition:all .15s ease">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px">
                <span style="font-size:12px; font-weight:600; color:var(--text)">Primary</span>
                <button class="audition-btn" data-mode="primary" style="padding:2px 6px; font-size:10px; border-radius:3px; border:1px solid var(--selected-border); background:transparent; color:var(--muted); cursor:pointer">Audition</button>
              </div>
              <div id="primaryRow" style="display:grid; grid-template-columns:repeat(8, 1fr); gap:4px; height:32px"></div>
            </div>

            <!-- Secondary Row -->
            <div class="triad-row" data-triad="secondary" style="margin-bottom:8px; padding:8px; border:2px solid transparent; border-radius:6px; cursor:pointer; transition:all .15s ease">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px">
                <span style="font-size:12px; font-weight:600; color:var(--text)">Secondary</span>
                <button class="audition-btn" data-mode="secondary" style="padding:2px 6px; font-size:10px; border-radius:3px; border:1px solid var(--selected-border); background:transparent; color:var(--muted); cursor:pointer">Audition</button>
              </div>
              <div id="secondaryRow" style="display:grid; grid-template-columns:repeat(8, 1fr); gap:4px; height:32px"></div>
            </div>

            <!-- Tertiary Row -->
            <div class="triad-row" data-triad="tertiary" style="margin-bottom:8px; padding:8px; border:2px solid transparent; border-radius:6px; cursor:pointer; transition:all .15s ease">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px">
                <span style="font-size:12px; font-weight:600; color:var(--text)">Tertiary</span>
                <button class="audition-btn" data-mode="tertiary" style="padding:2px 6px; font-size:10px; border-radius:3px; border:1px solid var(--selected-border); background:transparent; color:var(--muted); cursor:pointer">Audition</button>
              </div>
              <div id="tertiaryRow" style="display:grid; grid-template-columns:repeat(8, 1fr); gap:4px; height:32px"></div>
            </div>
          </div>

          <!-- Unified Generation Controls -->
          <div style="margin-bottom:16px">
            <h5 style="margin:0 0 8px 0; font-size:14px; color:var(--text)">
              <span id="selectedTriadName">Primary</span> Generation
            </h5>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:8px">
              <div>
                <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px">Hue Shift</label>
                <input id="genHue" type="range" min="-60" max="60" step="1" value="0" style="width:100%" />
                <div style="text-align:center; font-size:11px; color:var(--text)" id="genHue_val">0°</div>
              </div>
              <div>
                <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px">Lightness</label>
                <input id="genLight" type="range" min="-30" max="30" step="1" value="0" style="width:100%" />
                <div style="text-align:center; font-size:11px; color:var(--text)" id="genLight_val">0%</div>
              </div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px">
              <div>
                <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px">Saturation</label>
                <input id="genSat" type="range" min="-40" max="40" step="1" value="0" style="width:100%" />
                <div style="text-align:center; font-size:11px; color:var(--text)" id="genSat_val">0%</div>
              </div>
              <div>
                <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px">Alpha</label>
                <input id="genAlpha" type="range" min="0" max="1" step="0.05" value="1" style="width:100%" />
                <div style="text-align:center; font-size:11px; color:var(--text)" id="genAlpha_val">100%</div>
              </div>
            </div>
          </div>

          <!-- Promote Audition -->
          <div style="margin-bottom:8px; padding:10px; border:1px solid rgba(74,163,255,.2); border-radius:8px; background:rgba(74,163,255,.05); display:none" id="promoteSection">
            <div style="display:flex; justify-content:space-between; align-items:center">
              <span style="font-size:12px; color:var(--muted)">Auditioning <span id="promoteModeName" style="color:var(--accent); font-weight:600">Secondary</span> palette</span>
              <button class="btn primary" id="promoteBtn" style="padding:6px 12px; font-size:12px">Promote to Primary</button>
            </div>
          </div>

          <!-- Actions -->
          <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px">
            <button class="btn" id="undoTokensBtn" disabled>Undo</button>
            <button class="btn" id="resetTokensBtn">Reset</button>
            <button class="btn primary" id="redoTokensBtn" disabled>Redo</button>
          </div>
          <div style="margin-top:8px; text-align:center; font-size:11px; color:var(--muted)">
            Changes apply in real-time • <kbd style="background:#0a0f16; padding:2px 5px; border-radius:3px; border:1px solid var(--selected-border)">⌘Z</kbd> Undo • <kbd style="background:#0a0f16; padding:2px 5px; border-radius:3px; border:1px solid var(--selected-border)">⌘⇧Z</kbd> Redo
          </div>
          </div>
        </details>

        <!-- Opacity Section (Collapsible) -->
        <details style="margin-bottom:8px; border:1px solid rgba(26,38,54,.5); border-radius:8px; padding:12px">
          <summary style="font-size:16px; font-weight:600; color:var(--text); cursor:pointer; user-select:none; list-style:none">
            Opacity
          </summary>
          <div style="margin-top:16px">
            <p style="margin:0 0 16px 0; font-size:13px; color:var(--muted)">Control opacity for documentation panels and UI text elements.</p>

            <!-- Panel Opacity Controls -->
            <div style="margin-bottom:16px">
              <h5 style="margin:0 0 12px 0; font-size:14px; color:var(--text)">Panels</h5>

              <div class="row" style="margin-bottom:12px">
                <label>Docs Panel</label>
                <input id="docsOpacity" type="range" min="0.5" max="1.0" step="0.05" value="0.90" />
                <div class="val" id="docsOpacity_val">90%</div>
              </div>

              <div class="row" style="margin-bottom:12px">
                <label>Controls Panel</label>
                <input id="drawerOpacity" type="range" min="0.5" max="1.0" step="0.05" value="0.92" />
                <div class="val" id="drawerOpacity_val">92%</div>
              </div>
            </div>

            <!-- Text Opacity Controls -->
            <div style="margin-bottom:16px">
              <h5 style="margin:0 0 12px 0; font-size:14px; color:var(--text)">Text Elements</h5>

              <div class="row" style="margin-bottom:12px">
                <label>Headings (h1, h2)</label>
                <input id="headingsOpacity" type="range" min="0.3" max="1.0" step="0.05" value="1.0" />
                <div class="val" id="headingsOpacity_val">100%</div>
              </div>

              <div class="row" style="margin-bottom:12px">
                <label>Subheadings (h3, h4, h5)</label>
                <input id="subheadingsOpacity" type="range" min="0.3" max="1.0" step="0.05" value="0.95" />
                <div class="val" id="subheadingsOpacity_val">95%</div>
              </div>

              <div class="row" style="margin-bottom:12px">
                <label>Labels & Body Text</label>
                <input id="labelsOpacity" type="range" min="0.3" max="1.0" step="0.05" value="0.90" />
                <div class="val" id="labelsOpacity_val">90%</div>
              </div>

              <div class="row" style="margin-bottom:12px">
                <label>Muted Text</label>
                <input id="mutedOpacity" type="range" min="0.3" max="1.0" step="0.05" value="0.70" />
                <div class="val" id="mutedOpacity_val">70%</div>
              </div>
            </div>
          </div>
        </details>

        <!-- Typography Section (Collapsible) -->
        <details style="margin-bottom:8px; border:1px solid rgba(26,38,54,.5); border-radius:8px; padding:12px">
          <summary style="font-size:16px; font-weight:600; color:var(--text); cursor:pointer; user-select:none; list-style:none">
            Typography
          </summary>
          <div style="margin-top:16px">

            <!-- Simple 3-font selector in a row -->
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:16px">

              <!-- Text Font -->
              <div class="font-selector" data-category="text">
                <label style="font-size:12px; color:var(--text); display:block; margin-bottom:6px; font-weight:600">Text</label>
                <select id="fontText" style="width:100%; padding:8px; background:#0a0f16; border:1px solid var(--selected-border); border-radius:6px; color:var(--text); font-size:13px">
                  <option value="system">System</option>
                </select>
              </div>

              <!-- Panel Font -->
              <div class="font-selector" data-category="panel">
                <label style="font-size:12px; color:var(--text); display:block; margin-bottom:6px; font-weight:600">Panel</label>
                <select id="fontPanel" style="width:100%; padding:8px; background:#0a0f16; border:1px solid var(--selected-border); border-radius:6px; color:var(--text); font-size:13px">
                  <option value="system">System</option>
                </select>
              </div>

              <!-- Code Font -->
              <div class="font-selector" data-category="code">
                <label style="font-size:12px; color:var(--text); display:block; margin-bottom:6px; font-weight:600">Code</label>
                <select id="fontCode" style="width:100%; padding:8px; background:#0a0f16; border:1px solid var(--selected-border); border-radius:6px; color:var(--text); font-size:13px">
                  <option value="monospace">Monospace</option>
                </select>
              </div>

            </div>

            <!-- How to add fonts -->
            <details style="margin-top:12px; padding:10px; background:rgba(74,163,255,.05); border:1px solid rgba(74,163,255,.2); border-radius:6px">
              <summary style="font-size:12px; color:var(--accent); cursor:pointer; font-weight:600">How to add custom fonts</summary>
              <div style="margin-top:10px; font-size:12px; color:var(--muted); line-height:1.6">
                <p style="margin:0 0 8px 0">To add fonts to the dropdown list, edit <code style="background:#0a0f16; padding:2px 6px; border-radius:4px; font-family:monospace">sir.html</code> around line 293:</p>
                <pre style="background:#0a0f16; padding:10px; border-radius:6px; overflow-x:auto; margin:8px 0; border:1px solid var(--selected-border)"><code style="font-family:monospace; font-size:11px; color:#e6eef9">const googleFonts = {
  sans: [
    {name: 'Inter', weights: [400, 600, 700]},
    {name: 'Your Font Name', weights: [400, 700]},
    // Add more here
  ],
  mono: [
    {name: 'Fira Code', weights: [400, 600]},
    // Add more here
  ]
};</code></pre>
                <p style="margin:8px 0 0 0">Font names must match <a href="https://fonts.google.com" target="_blank" style="color:var(--accent); text-decoration:none">Google Fonts</a> exactly.</p>
              </div>
            </details>

            <!-- Font Actions -->
            <div style="display:grid; grid-template-columns:1fr; gap:8px; margin-top:12px">
              <button class="btn" id="resetFontsBtn">Reset to System Fonts</button>
            </div>
          </div>
        </details>

    </section>
    <section id="tabConfig" hidden>
      <h4>Configuration</h4>
      <p>Save and restore named UI configurations including colors, opacity, and design tokens.</p>

      <div style="margin:16px 0">
        <!-- Status Message -->
        <div id="configStatus" style="display:none; padding:6px 12px; border-radius:6px; font-size:13px; margin-bottom:12px; text-align:center"></div>

        <!-- Save Current -->
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:16px">
          <label style="color:var(--text); white-space:nowrap; font-size:13px">Save current:</label>
          <input type="text" id="configNameInput" placeholder="Enter name" style="flex:1; padding:8px 12px; background:#0a0f16; border:1px solid var(--selected-border); border-radius:8px; color:var(--text); font-size:13px" />
          <button class="btn primary" id="saveConfigBtn">Save</button>
        </div>

        <!-- Saved Configs List -->
        <div id="configList" style="display:grid; gap:8px"></div>
      </div>
    </section>
  </div>
</div>
