:root{
  --bg:#0b0f14; --panel:#11161d; --muted:#9fb2c6; --text:#dbe7f3; --accent:#4aa3ff;
  --accent-2:#ff6b6b; --good:#29d398; --warn:#f7b955; --grid:#1a2230;
  --z-base:1; --z-overlay:10; --z-drawer:20; --z-fab:30; --z-modal:40;
  --selected-border:#223044; --selected-bg:#111a26;
  --opacity-headings:1.0; --opacity-subheadings:0.95; --opacity-labels:0.9; --opacity-muted:0.7;
  --font-text:system-ui,-apple-system,sans-serif;
  --font-text-light:300; --font-text-normal:400; --font-text-bold:700;
  --font-code:monospace;
  --font-code-light:300; --font-code-normal:400; --font-code-bold:700;
  --font-panel:system-ui,-apple-system,sans-serif;
  --font-panel-light:400; --font-panel-normal:500; --font-panel-bold:700;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; background:var(--bg); color:var(--text); font-family:var(--font-text); font-size:14px; line-height:1.4; font-weight:var(--font-text-normal); overflow:hidden;}

/* Custom scrollbars */
::-webkit-scrollbar{width:10px; height:10px}
::-webkit-scrollbar-track{background:#0d141d; border-radius:5px}
::-webkit-scrollbar-thumb{background:#223044; border-radius:5px; border:2px solid #0d141d}
::-webkit-scrollbar-thumb:hover{background:#2a4566}
*{scrollbar-width:thin; scrollbar-color:#223044 #0d141d}
.wrap{position:relative; height:100%; width:100%; display:grid; grid-template-rows:auto 1fr; gap:8px; padding:12px 12px 84px 12px;}
header{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center;}
.title{font-family:var(--font-panel); font-weight:var(--font-panel-bold); letter-spacing:.2px; opacity:var(--opacity-headings)}
.stats{display:grid; grid-auto-flow:column; gap:18px; justify-content:end; align-items:center; color:var(--muted); font-variant-numeric:tabular-nums; opacity:var(--opacity-muted)}
.pill{padding:4px 8px; border-radius:999px; background:var(--panel); color:var(--text); border:1px solid #18202c}
.pill b{color:var(--accent); font-weight:600}
.legend{display:flex; gap:12px; align-items:center; color:var(--muted); opacity:var(--opacity-muted)}
.swatch{width:10px; height:10px; border-radius:2px; display:inline-block; margin-right:6px}
.grid{display:grid; grid-template-columns:1fr 1fr; gap:12px; height:100%;}
.card{position:relative; background:var(--panel); border:1px solid #18202c; border-radius:14px; overflow:hidden; box-shadow:0 10px 24px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.02);}
.card h3{margin:0; padding:10px 12px; font-family:var(--font-panel); font-weight:var(--font-panel-bold); background:#0e141c; border-bottom:1px solid #18202c; opacity:var(--opacity-subheadings)}
.canvas-wrap{position:relative; height:calc(100% - 42px)}
canvas{display:block; width:100%; height:100%; background:linear-gradient(#0d131b,#0c1219)}
.overlay-note{position:absolute; left:12px; bottom:10px; color:var(--muted); font-size:12px; text-shadow:0 1px 0 #000a;}

/* FABs */
.fab-row{position:fixed; right:18px; bottom:18px; display:flex; gap:12px; align-items:center; z-index:var(--z-fab);}
.fab{width:58px; height:58px; border-radius:50%; display:grid; place-items:center; font-size:26px; border:none; cursor:pointer; transition:transform .12s ease, box-shadow .12s ease, background .25s ease; box-shadow:0 10px 24px rgba(0,0,0,.35)}
.fab:hover{transform:translateY(-2px); box-shadow:0 14px 30px rgba(0,0,0,.42)}
.fab.sim{background:var(--accent); color:#05101c}
.fab.doc{background:var(--good); color:#06140f}
.fab.critical{animation:critical-pulse 1.8s ease-in-out infinite}
@keyframes critical-pulse{0%,100%{box-shadow:0 0 0 0 rgba(247,185,85,.0), 0 10px 24px rgba(0,0,0,.35)}50%{box-shadow:0 0 0 22px rgba(247,185,85,.12), 0 12px 28px rgba(0,0,0,.4)}}

/* Right drawer (simulation controls) */
.drawer{position:fixed; right:18px; bottom:86px; width:min(420px,calc(100% - 36px)); max-height:min(70vh,560px); overflow:auto; padding:0; background:rgba(14,20,28,.75); backdrop-filter:blur(16px) saturate(1.3); -webkit-backdrop-filter:blur(16px) saturate(1.3); border:1px solid rgba(25,34,50,.6); border-radius:16px; z-index:var(--z-modal); box-shadow:0 10px 28px rgba(0,0,0,.5); display:none; opacity:0.92;}
.drawer.open{display:block}

/* Control tabs (top-level physics mode selector) */
.drawer-header{padding:10px 12px 8px 12px; background:rgba(11,17,26,.85); border-bottom:1px solid rgba(25,34,50,.8); border-radius:16px 16px 0 0;}
.control-tabs{display:flex; gap:6px; align-items:center;}
.control-tab{appearance:none; padding:7px 16px; border-radius:9px; border:1px solid #1f2b3c; background:#0f1a27; color:var(--muted); cursor:pointer; font-size:13px; font-weight:600; transition:all .15s ease; letter-spacing:.3px}
.control-tab:hover{border-color:#2a4566; background:#132237}
.control-tab.active{background:#1a2a3f; border-color:#27405f; color:var(--text); box-shadow:0 0 0 1px rgba(74,163,255,.08)}
.control-tab:disabled{opacity:0.4; cursor:not-allowed; color:#556070}

/* Controls section (boxed with header) */
.drawer-controls{padding:12px; background:rgba(14,20,28,.4); border-bottom:1px solid rgba(25,34,50,.5)}
.control-section{display:none}
.control-section.active{display:block}
.row{display:grid; grid-template-columns:140px 1fr auto; gap:8px; align-items:center; margin:8px 0}
.row label{color:var(--muted); opacity:var(--opacity-labels)}
input[type=range]{width:100%; accent-color: var(--accent)}
.val{min-width:64px; text-align:right; color:var(--text); font-variant-numeric:tabular-nums}
.btn{appearance:none; border:1px solid #223044; background:#111a26; color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer; transition:all .15s ease}
.btn:hover{border-color:#2a4a6f; background:#172534}
.btn.primary{border-color:#284b7a; background:#0f2136}
.btn.danger{border-color:#5a1b1b; background:#221012; color:#ffd0d0}


/* Presets section (clean, centered) */
.presets-section{padding:0 12px 12px 12px; background:transparent}
.preset-tabs{display:flex; gap:6px; align-items:center; justify-content:center; margin-bottom:12px}
.preset-tab{appearance:none; padding:6px 14px; border-radius:8px; border:1px solid transparent; background:transparent; color:var(--muted); cursor:pointer; font-size:13px; font-weight:500; transition:all .15s ease}
.preset-tab:hover{color:var(--text)}
.preset-tab.active{border-color:var(--selected-border); background:var(--selected-bg); color:var(--text)}
.preset-content{display:none; overflow:hidden; transition:all .25s ease}
.preset-content.open{display:block}
.button-grid{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:8px}
.grid-btn{appearance:none; border:1px solid #223044; background:#111a26; color:var(--text); padding:6px 10px; border-radius:5px; cursor:pointer; font-size:13px; text-align:center; transition:all .15s ease}
.grid-btn:hover{background:#152136; border-color:#2a4566; transform:translateY(-1px)}
.grid-btn.selected{background:#0f2136; border-color:#284b7a; color:var(--accent)}
.drawer-actions{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px}

/* Right doc panel */
.docpanel{position:fixed; right:18px; bottom:154px; width:min(560px,calc(100% - 36px)); max-height:min(78vh,680px); overflow:auto; padding:0; background:rgba(15,21,31,.88); backdrop-filter:blur(14px) saturate(1.3); -webkit-backdrop-filter:blur(14px) saturate(1.3); border:1px solid rgba(26,38,54,.85); border-radius:18px; z-index:var(--z-drawer); box-shadow:0 10px 28px rgba(0,0,0,.55); display:none;}
.docpanel.open{display:block}
.dochead{position:sticky; top:0; background:rgba(13,20,29,.92); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px); border-bottom:1px solid rgba(26,38,54,.9); padding:10px 12px}
.tabs{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.tab{padding:8px 10px; border-radius:10px; border:1px solid #1f2b3c; background:#0f1a27; color:var(--text); cursor:pointer; font-family:var(--font-panel); font-weight:600;}
.tab[aria-selected="true"]{background:#132237; border-color:#27405f}
.subtabs{display:none; gap:6px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:8px; padding-top:8px; border-top:1px solid rgba(26,38,54,.5)}
.subtabs.active{display:flex}
.subtab{padding:6px 8px; border-radius:8px; border:1px solid #1a2836; background:#0a0f16; color:var(--muted); cursor:pointer; font-size:13px; font-weight:500; font-family:var(--font-text);}
.subtab[aria-selected="true"]{background:#0f1a27; border-color:#1f2b3c; color:var(--text)}
.docbody{padding:14px 16px; font-size:18px; line-height:1.6; font-family:var(--font-text)}
.docbody section{min-height:500px}
.docbody h1,.docbody h2{opacity:var(--opacity-headings); font-family:var(--font-panel); font-weight:var(--font-panel-bold)}
.docbody h3,.docbody h4,.docbody h5{opacity:var(--opacity-subheadings); font-family:var(--font-panel)}
.docbody h4{margin:12px 0 6px 0; font-size:18px}
.docbody p{margin:0 0 12px 0; color:#e6eef9; font-family:var(--font-text)}
.docbody code{background:#0c1219; border:1px solid #1a2636; padding:1px 6px; border-radius:8px; font-family:var(--font-code)}
.docbody ul{margin:6px 0 12px 18px; font-family:var(--font-text)}
.docbody li{margin:4px 0; font-family:var(--font-text)}
.sir-s{color:#4aa3ff; font-weight:600}
.sir-i{color:#ff6b6b; font-weight:600}
.sir-r{color:#29d398; font-weight:600}
.r-number{color:#f7b955; font-weight:600}
.param-set{cursor:pointer; padding:2px 5px; border-radius:6px; background:rgba(74,163,255,.12); border:1px solid rgba(74,163,255,.25); transition:all .15s ease; font-family:var(--font-code); font-weight:var(--font-code-normal)}
.param-set:hover{background:rgba(74,163,255,.22); border-color:rgba(74,163,255,.45); transform:translateY(-1px)}
.example-grid{display:grid; gap:10px; margin:12px 0}
.example-btn{appearance:none; border:1px solid #223044; background:#111a26; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer; text-align:left; transition:all .15s ease}
.example-btn:hover{background:#152136; border-color:#2a4566; transform:translateY(-1px)}
.example-btn .example-title{font-weight:600; margin-bottom:4px; color:var(--accent)}
.example-btn .example-desc{font-size:13px; color:var(--muted); line-height:1.4}

/* Critical overlay */
.critical-overlay{pointer-events:none; position:fixed; inset:0; opacity:0; transition:opacity .3s ease; background:radial-gradient(60% 50% at 70% 80%, rgba(247,185,85,.06), rgba(247,185,85,0) 60%), radial-gradient(40% 40% at 20% 20%, rgba(255,107,107,.05), rgba(255,107,107,0) 60%); z-index:var(--z-overlay);}
.critical .critical-overlay{opacity:1}

.axis-label{position:absolute; right:10px; top:8px; color:var(--muted); font-size:12px}

/* Chart tabs */
.chart-tab{appearance:none; padding:6px 12px; border-radius:8px; border:1px solid #1a2636; background:#0a0f16; color:var(--muted); cursor:pointer; font-size:13px; font-weight:500; transition:all .15s ease}
.chart-tab:hover{border-color:#223044; background:#0f1a27}
.chart-tab.active{background:#0f2136; border-color:#284b7a; color:var(--accent)}

/* Experiment list items */
.experiment-item{padding:8px 10px; background:#0f1a27; border:1px solid #1a2636; border-radius:8px; cursor:pointer; transition:all .15s ease; display:flex; flex-direction:row-reverse; gap:10px; align-items:center}
.experiment-item:hover{background:#132237; border-color:#223044; transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.3)}
.experiment-item canvas{border:1px solid #1a2636; box-shadow:0 2px 4px rgba(0,0,0,.2); width:50px; height:50px}
.experiment-item .exp-name{font-weight:600; color:var(--text); margin-bottom:2px; font-size:13px}
.experiment-item .exp-params{font-size:11px; color:var(--muted); font-family:var(--font-code); line-height:1.4}
.experiment-item .exp-timestamp{font-size:10px; color:#556070; margin-top:2px}

/* Config list items */
.config-item{padding:10px 12px; background:#0f1a27; border:1px solid var(--selected-border); border-radius:8px; display:flex; flex-direction:column; gap:6px; transition:all .15s ease; cursor:pointer}
.config-item:hover{background:#132237; border-color:#2a4566; transform:translateY(-1px)}
.config-item-header{display:flex; justify-content:space-between; align-items:center}
.config-item-name{font-weight:600; color:var(--text); font-size:13px}
.config-item-meta{font-size:11px; color:var(--muted)}
.config-item-actions{display:flex; gap:6px}
.config-item-btn{appearance:none; border:1px solid var(--selected-border); background:#0a0f16; color:var(--text); padding:4px 10px; border-radius:5px; cursor:pointer; font-size:12px; transition:all .15s ease}
.config-item-btn:hover{background:#172534; border-color:#2a4566}
.config-item-btn.load{border-color:#284b7a; color:var(--accent)}
.config-item-btn.delete{border-color:#5a1b1b; color:#ff6b6b}

/* Config status messages */
.config-status{animation:fadeIn .2s ease}
.config-status.success{background:rgba(41,211,152,.15); border:1px solid rgba(41,211,152,.3); color:var(--good)}
.config-status.error{background:rgba(255,107,107,.15); border:1px solid rgba(255,107,107,.3); color:var(--accent-2)}
.config-status.info{background:rgba(159,178,198,.10); border:1px solid rgba(159,178,198,.2); color:var(--muted)}
@keyframes fadeIn{from{opacity:0; transform:translateY(-4px)}to{opacity:1; transform:translateY(0)}}

/* Design token color pickers */
input[type="color"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background: transparent;
  cursor: pointer;
}
input[type="color"]::-webkit-color-swatch-wrapper {
  padding: 0;
  border-radius: 4px;
}
input[type="color"]::-webkit-color-swatch {
  border: 1px solid rgba(255,255,255,.15);
  border-radius: 4px;
}
input[type="color"]::-moz-color-swatch {
  border: 1px solid rgba(255,255,255,.15);
  border-radius: 4px;
}

/* Audition buttons */
.audition-btn {
  transition: all .15s ease;
  font-family: system-ui, -apple-system, sans-serif;
}
.audition-btn:hover {
  background: rgba(74,163,255,.1) !important;
  border-color: rgba(74,163,255,.4) !important;
  color: var(--accent) !important;
}

/* Triad rows */
.triad-row:hover {
  background: rgba(34,48,68,.1) !important;
  transform: translateX(2px);
}

/* Smooth color transitions */
:root {
  transition:
    --bg .3s ease,
    --panel .3s ease,
    --text .3s ease,
    --muted .3s ease,
    --accent .3s ease,
    --accent-2 .3s ease,
    --good .3s ease,
    --warn .3s ease;
}

/* Collapsible details - tighter spacing when closed */
details:not([open]) {
  padding:8px 12px !important;
  margin-bottom:4px !important;
}
