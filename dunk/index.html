<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dunk - Bass Synthesis Machine</title>
  <link rel="stylesheet" href="dunk.css">
</head>
<body>
  <div id="app">
    <!-- HUD -->
    <header id="hud">
      <div class="hud-left">
        <button id="btn-start" class="btn-primary">Start</button>
        <div class="hud-control">
          <label>BPM</label>
          <input type="number" id="bpm" value="140" min="60" max="200" step="1">
        </div>
        <div id="status" class="status-idle">Ready</div>
      </div>
      <div class="hud-center">
        <div id="perf-meters">
          <div class="perf-meter">
            <label>FPS</label>
            <span id="perf-fps" class="value">--</span>
          </div>
          <div class="perf-meter">
            <label>CPU</label>
            <span id="perf-cpu" class="value">--%</span>
          </div>
          <div class="perf-meter">
            <label>LAT</label>
            <span id="perf-latency" class="value">-- ms</span>
          </div>
        </div>
      </div>
      <div class="hud-right">
        <button id="btn-oneshot" class="btn-oneshot" title="One-Shot (T)">&#9679;</button>
        <div class="transport">
          <button id="btn-play" class="btn-transport" title="Play">&#9654;</button>
          <button id="btn-stop" class="btn-transport" title="Stop">&#9632;</button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div id="main-content">
      <div id="main-area">
        <!-- Spectrum Analyzer with Tuner -->
        <section id="phosphor-section">
          <div class="section-header">
            <h3>Spectrum Analyzer</h3>
            <div class="section-controls">
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-fft" checked>
                <div class="toggle-track"><div class="toggle-thumb"></div></div>
                <span>FFT</span>
              </label>
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-tuner" checked>
                <div class="toggle-track"><div class="toggle-thumb"></div></div>
                <span>Tuner</span>
              </label>
            </div>
          </div>
          <div class="canvas-container analyzer-display">
            <canvas id="phosphor-canvas"></canvas>
            <div id="tuner-overlay" class="tuner-overlay">
              <div id="tuner-note" class="tuner-note">--</div>
              <div id="tuner-freq" class="tuner-freq">-- Hz</div>
              <div class="tuner-cents">
                <div class="tuner-cents-bar">
                  <div class="tuner-cents-center"></div>
                  <div id="tuner-cents-indicator" class="tuner-cents-indicator"></div>
                </div>
                <span id="tuner-cents-value" class="tuner-cents-value">-- ct</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Phase Meter -->
        <section id="phase-section">
          <div class="section-header">
            <h3>Phase Correlation</h3>
            <div class="section-controls">
              <label class="toggle-switch">
                <input type="checkbox" id="toggle-phase" checked>
                <div class="toggle-track"><div class="toggle-thumb"></div></div>
                <span>Enable</span>
              </label>
            </div>
          </div>
          <div class="canvas-container phase-display">
            <div class="phase-scope">
              <canvas id="phase-canvas"></canvas>
            </div>
            <div class="phase-meter-bar">
              <div class="phase-labels"><span>+1</span><span>L/R</span></div>
              <div class="phase-correlation">
                <div id="phase-correlation-bar" class="phase-correlation-bar"></div>
              </div>
              <div class="phase-labels"><span>-1</span><span id="phase-value">0.00</span></div>
            </div>
          </div>
        </section>

        <!-- Signal Chain Schematic -->
        <section id="schematic-section">
          <div class="section-header">
            <h3>Signal Chain</h3>
            <div class="section-controls schematic-controls">
              <div class="zoom-control">
                <button id="zoom-out">-</button>
                <span id="zoom-value" class="zoom-value">100%</span>
                <button id="zoom-in">+</button>
              </div>
              <button id="zoom-fit" class="btn-secondary">Fit</button>
            </div>
          </div>
          <div class="canvas-container schematic-viewport" id="schematic-viewport">
            <canvas id="schematic-canvas"></canvas>
          </div>
        </section>

        <!-- 16-Step Sequencer -->
        <section id="sequencer-section">
          <div class="section-header">
            <h3>Sequencer</h3>
          </div>
          <div id="sequencer">
            <div id="steps">
              <!-- Steps generated by JS -->
            </div>
            <div id="sequencer-controls">
              <div class="control-group">
                <label>Voice</label>
                <div id="voice-select">
                  <button class="voice-btn active" data-voice="0">0</button>
                  <button class="voice-btn" data-voice="1">1</button>
                  <button class="voice-btn" data-voice="2">2</button>
                  <button class="voice-btn" data-voice="3">3</button>
                </div>
              </div>
              <div class="control-group">
                <label>Swing</label>
                <input type="range" id="swing" min="0" max="100" value="0">
                <span id="swing-val">0%</span>
              </div>
              <div class="control-group">
                <label>Prob</label>
                <input type="range" id="probability" min="0" max="100" value="100">
                <span id="prob-val">100%</span>
              </div>
              <div class="control-group">
                <button id="btn-clear-pattern" class="btn-mini">Clear</button>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Sidepanel -->
      <aside id="sidepanel">
        <nav id="sidepanel-tabs">
          <button class="tab-btn active" data-tab="tips">Tips</button>
          <button class="tab-btn" data-tab="help">Help</button>
          <button class="tab-btn" data-tab="808">808</button>
          <button class="tab-btn" data-tab="303">303</button>
          <button class="tab-btn" data-tab="dubstep">Dub</button>
        </nav>
        <div id="sidepanel-content">
          <!-- Content loaded by sidepanel.js -->
        </div>
      </aside>
    </div>

    <!-- Bottom Toolbar -->
    <footer id="toolbar">
      <div class="toolbar-left">
        <select id="preset-select">
          <option value="">-- Presets --</option>
          <option value="808-classic">808 Classic</option>
          <option value="dubstep-wobble">Dubstep Wobble</option>
          <option value="reese-bass">Reese Bass</option>
          <option value="nasty-sub">Nasty Sub</option>
        </select>
        <button id="btn-filter-design" class="btn-secondary">Filter</button>
        <button id="btn-nasty-range" class="btn-secondary">Nasty</button>
        <button id="btn-envelope" class="btn-secondary">Envelope</button>
        <button id="btn-controller" class="btn-secondary">Controller</button>
      </div>
      <div class="toolbar-center">
        <div id="midi-status" class="midi-status disconnected">
          <span class="midi-icon">&#9835;</span>
          <span class="midi-device">No MIDI</span>
        </div>
        <span id="footer-midi-activity" class="midi-activity">--</span>
      </div>
      <div class="toolbar-right">
        <button id="btn-midi-learn" class="btn-secondary">MIDI Learn</button>
        <button id="btn-save" class="btn-secondary">Save</button>
        <button id="btn-load" class="btn-secondary">Load</button>
        <button id="btn-export" class="btn-secondary">Export</button>
      </div>
    </footer>

    <!-- Floating Panels -->
    <div id="panel-filter-design" class="floating-panel hidden">
      <div class="panel-header">
        <h4>Filter Design</h4>
        <button class="btn-close">&times;</button>
      </div>
      <div class="panel-content">
        <div class="canvas-container analyzer-display">
          <canvas id="filter-response-canvas"></canvas>
        </div>
        <div class="filter-controls">
          <div class="control-row">
            <label>Cutoff</label>
            <input type="range" id="filter-cutoff" min="20" max="2000" value="200">
            <span id="filter-cutoff-val">200 Hz</span>
          </div>
          <div class="control-row">
            <label>Taps</label>
            <select id="filter-taps">
              <option value="63">63</option>
              <option value="127" selected>127</option>
              <option value="191">191</option>
              <option value="255">255</option>
            </select>
          </div>
          <div class="control-row">
            <label>Window</label>
            <select id="filter-window">
              <option value="hamming">Hamming</option>
              <option value="blackman" selected>Blackman</option>
              <option value="kaiser">Kaiser</option>
            </select>
          </div>
          <div class="control-row">
            <label>Preset</label>
            <select id="filter-preset">
              <option value="808-lpf">808-LPF</option>
              <option value="sub-pass">Sub-Pass</option>
              <option value="dubstep-mid">Dubstep-Mid</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-nasty-range" class="floating-panel hidden">
      <div class="panel-header">
        <h4>Nasty Range</h4>
        <button class="btn-close">&times;</button>
      </div>
      <div class="panel-content">
        <div class="nasty-controls">
          <div class="control-row">
            <label>Decay Fine</label>
            <input type="range" id="nasty-decay-fine" min="0" max="100" value="50">
            <span id="nasty-decay-fine-val">0.50</span>
          </div>
          <div class="control-row">
            <label>Decay Extend</label>
            <input type="range" id="nasty-decay-extend" min="50" max="2000" value="200">
            <span id="nasty-decay-extend-val">200 ms</span>
          </div>
          <div class="control-row">
            <label>Sub-Harmonic</label>
            <input type="range" id="nasty-sub-harmonic" min="0" max="100" value="30">
            <span id="nasty-sub-harmonic-val">0.30</span>
          </div>
          <div class="control-row">
            <label>Click Intensity</label>
            <input type="range" id="nasty-click" min="0" max="100" value="40">
            <span id="nasty-click-val">0.40</span>
          </div>
          <div class="control-row">
            <label>Grime Amount</label>
            <input type="range" id="nasty-grime" min="0" max="100" value="20">
            <span id="nasty-grime-val">0.20</span>
          </div>
          <div class="control-row">
            <label>Pitch Drift</label>
            <input type="range" id="nasty-pitch-drift" min="-50" max="50" value="0">
            <span id="nasty-pitch-drift-val">0 cents</span>
          </div>
          <div class="control-row">
            <label>Growl Freq</label>
            <input type="range" id="nasty-growl" min="400" max="800" value="600">
            <span id="nasty-growl-val">600 Hz</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-voice" class="floating-panel hidden">
      <div class="panel-header">
        <h4>Voice <span id="voice-panel-num">0</span></h4>
        <button class="btn-close">&times;</button>
      </div>
      <div class="panel-content">
        <div class="channel-controls">
          <div class="channel-row" data-channel="0">
            <span class="ch-label">Sub</span>
            <input type="range" class="ch-level" min="0" max="100" value="80">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="1">
            <span class="ch-label">Body</span>
            <input type="range" class="ch-level" min="0" max="100" value="60">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="2">
            <span class="ch-label">Click</span>
            <input type="range" class="ch-level" min="0" max="100" value="50">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="3">
            <span class="ch-label">Harm</span>
            <input type="range" class="ch-level" min="0" max="100" value="30">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="4">
            <span class="ch-label">SubH</span>
            <input type="range" class="ch-level" min="0" max="100" value="40">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="5">
            <span class="ch-label">Form</span>
            <input type="range" class="ch-level" min="0" max="100" value="20">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="6">
            <span class="ch-label">Noise</span>
            <input type="range" class="ch-level" min="0" max="100" value="15">
            <button class="ch-mute">M</button>
          </div>
          <div class="channel-row" data-channel="7">
            <span class="ch-label">Reese</span>
            <input type="range" class="ch-level" min="0" max="100" value="25">
            <button class="ch-mute">M</button>
          </div>
        </div>
        <div class="voice-effects">
          <div class="control-row">
            <label>Distortion</label>
            <select id="voice-distortion">
              <option value="tanh">Tanh</option>
              <option value="cubic">Cubic</option>
              <option value="hardclip">Hard Clip</option>
              <option value="foldback">Foldback</option>
              <option value="bitcrush">Bitcrush</option>
              <option value="variable">Variable</option>
            </select>
            <input type="range" id="voice-dist-amount" min="0" max="100" value="30">
          </div>
          <div class="control-row">
            <label>Filter</label>
            <select id="voice-filter">
              <option value="808-lpf">808-LPF</option>
              <option value="sub-pass">Sub-Pass</option>
              <option value="dubstep-mid">Dubstep-Mid</option>
              <option value="custom">Custom</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-lfo" class="floating-panel hidden">
      <div class="panel-header">
        <h4>LFO / Wobble</h4>
        <button class="btn-close">&times;</button>
      </div>
      <div class="panel-content">
        <div class="lfo-controls">
          <div class="control-row">
            <label>Rate</label>
            <input type="range" id="lfo-rate" min="0.5" max="16" step="0.1" value="4">
            <span id="lfo-rate-val">4.0 Hz</span>
          </div>
          <div class="control-row">
            <label>Depth</label>
            <input type="range" id="lfo-depth" min="0" max="100" value="50">
            <span id="lfo-depth-val">50%</span>
          </div>
          <div class="control-row">
            <label>Waveform</label>
            <select id="lfo-waveform">
              <option value="sine">Sine</option>
              <option value="triangle">Triangle</option>
              <option value="square">Square</option>
              <option value="sawtooth">Sawtooth</option>
              <option value="sample-hold">Sample & Hold</option>
            </select>
          </div>
          <div class="control-row">
            <label>Target</label>
            <select id="lfo-target">
              <option value="filter">Filter Cutoff</option>
              <option value="amplitude">Amplitude</option>
              <option value="pitch">Pitch</option>
            </select>
          </div>
          <div class="control-row">
            <label>Sync</label>
            <input type="checkbox" id="lfo-sync">
            <span>Tempo Sync</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-master" class="floating-panel hidden">
      <div class="panel-header">
        <h4>Master Bus</h4>
        <button class="btn-close">&times;</button>
      </div>
      <div class="panel-content">
        <div class="master-controls">
          <div class="control-row">
            <label>Compressor</label>
            <input type="range" id="master-comp-thresh" min="-60" max="0" value="-24">
            <span id="master-comp-thresh-val">-24 dB</span>
          </div>
          <div class="control-row">
            <label>Ratio</label>
            <input type="range" id="master-comp-ratio" min="1" max="20" value="4">
            <span id="master-comp-ratio-val">4:1</span>
          </div>
          <div class="control-row">
            <label>Reverb Mix</label>
            <input type="range" id="master-reverb" min="0" max="100" value="10">
            <span id="master-reverb-val">10%</span>
          </div>
          <div class="control-row">
            <label>Limiter</label>
            <input type="range" id="master-limiter" min="-12" max="0" value="-3">
            <span id="master-limiter-val">-3 dB</span>
          </div>
          <div class="control-row">
            <label>Master Level</label>
            <input type="range" id="master-level" min="0" max="100" value="80">
            <span id="master-level-val">80%</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-envelope" class="floating-panel hidden">
      <div class="panel-header">
        <h4>Envelope Control</h4>
        <button class="btn-close">&times;</button>
      </div>
      <div class="panel-content">
        <div class="envelope-section">
          <h5>Pitch Envelope (808-style)</h5>
          <div class="control-row">
            <label>Start Freq</label>
            <input type="range" id="env-pitch-start" min="60" max="400" value="130">
            <span id="env-pitch-start-val">130 Hz</span>
          </div>
          <div class="control-row">
            <label>End Freq</label>
            <input type="range" id="env-pitch-end" min="20" max="100" value="50">
            <span id="env-pitch-end-val">50 Hz</span>
          </div>
          <div class="control-row">
            <label>Pitch Time</label>
            <input type="range" id="env-pitch-time" min="2" max="50" value="6">
            <span id="env-pitch-time-val">6 ms</span>
          </div>
        </div>
        <div class="envelope-section">
          <h5>Amplitude Envelope</h5>
          <div class="control-row">
            <label>Attack</label>
            <input type="range" id="env-amp-attack" min="0" max="20" value="2">
            <span id="env-amp-attack-val">2 ms</span>
          </div>
          <div class="control-row">
            <label>Decay</label>
            <input type="range" id="env-amp-decay" min="50" max="800" value="200">
            <span id="env-amp-decay-val">200 ms</span>
          </div>
          <div class="control-row">
            <label>Decay Shape</label>
            <input type="range" id="env-decay-shape" min="0" max="100" value="50">
            <span id="env-decay-shape-val">Exp</span>
          </div>
        </div>
        <div class="envelope-section">
          <h5>Ganging</h5>
          <div class="control-row gang-row">
            <label>Gang Voices</label>
            <div class="gang-checkboxes">
              <label><input type="checkbox" id="gang-v0" checked> V0</label>
              <label><input type="checkbox" id="gang-v1"> V1</label>
              <label><input type="checkbox" id="gang-v2"> V2</label>
              <label><input type="checkbox" id="gang-v3"> V3</label>
            </div>
          </div>
          <div class="control-row gang-row">
            <label>Gang Channels</label>
            <div class="gang-checkboxes">
              <label><input type="checkbox" id="gang-ch-sub" checked> Sub</label>
              <label><input type="checkbox" id="gang-ch-body" checked> Body</label>
              <label><input type="checkbox" id="gang-ch-harm"> Harm</label>
              <label><input type="checkbox" id="gang-ch-all"> ALL</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/core.js"></script>
  <script src="js/state.js"></script>
  <script src="js/fir.js"></script>
  <script src="js/envelope.js"></script>
  <script src="js/distortion.js"></script>
  <script src="js/channel.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/effects.js"></script>
  <script src="js/lfo.js"></script>
  <script src="js/nasty.js"></script>
  <script src="js/sequencer.js"></script>
  <script src="js/analyser.js"></script>
  <script src="js/phase.js"></script>
  <script src="js/schematic.js"></script>
  <script src="js/sidepanel.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/midi.js"></script>
  <script src="js/controller.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
